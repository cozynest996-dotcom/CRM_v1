# 工作流节点分类说明

## 概述
工作流编辑器中的节点已经按功能进行了清晰的分类，方便用户快速查找和使用。

## 节点分类

### 1. 🎯 触发器（Triggers）
触发器是工作流的起点，定义了工作流何时开始执行。

- **📱 消息触发器** (MessageTrigger)
  - 当收到新消息时触发（WhatsApp、Telegram等）
  - 配置项：渠道、匹配键

- **⏰ 时间触发器** (TimeTrigger)
  - 按设定的时间间隔触发
  - 配置项：计划时间、时区

- **🗄️ 数据库触发器** (DbTrigger)
  - 当数据库状态变化时触发
  - 配置项：表名、字段、条件

### 2. 🧠 逻辑处理（Logic Nodes）
处理业务逻辑和决策的节点。

- **🤖 AI 处理** (AI)
  - AI分析消息并生成回复
  - 支持置信度阈值判断，低置信度可转人工
  - 配置项：模型、温度、最大令牌数、置信度阈值

- **🔀 条件判断** (Condition)
  - 根据条件进行分支判断
  - 支持可视化和JSONLogic两种模式
  - 输出：true/false 分支

### 3. ⚡ 动作执行（Action Nodes）
执行具体操作的节点。

- **💬 发送消息** (SendWhatsAppMessage)
  - 发送 WhatsApp 消息
  - 配置项：重试策略、去重、熔断器

- **📝 模板消息** (Template)
  - 使用预设模板回复
  - 支持文本模板和 WhatsApp 模板
  - 配置项：模板类型、变量、备用模板

- **💾 更新数据** (UpdateDB)
  - 保存数据到数据库
  - 配置项：表名、匹配键、乐观锁、审计日志

### 4. 🛠️ 工具节点（Tool Nodes）
辅助功能节点。

- **⏰ 时间延迟** (Delay)
  - 延迟执行下一步
  - 支持工作时段和抖动
  - 配置项：延迟策略、工作时间、最大次数

- **🛡️ 合规检查** (GuardrailValidator)
  - 检查内容是否合规
  - 配置项：敏感词、URL白名单
  - 输出：通过/失败 分支

- **🔗 自定义API** (CustomAPI)
  - 调用外部API接口
  - 配置项：方法、URL、认证、重试
  - 输出：成功/失败 分支

## 使用方式

### 添加触发器
1. 点击工具栏的"+ 添加触发器"按钮
2. 从弹窗中选择合适的触发器类型
3. 在节点配置面板中设置具体参数

### 添加节点
1. 点击工具栏的"+ 添加节点"按钮
2. 使用分类标签快速筛选：
   - **全部**：显示所有可用节点
   - **🧠 逻辑**：AI处理、条件判断
   - **⚡ 动作**：发送消息、更新数据
   - **🛠️ 工具**：延迟、检查、API
3. 点击需要的节点即可添加到画布

## 节点连接规则

### 单输出节点
- 触发器（MessageTrigger、TimeTrigger、DbTrigger）
- 更新数据（UpdateDB）
- 发送消息（SendWhatsAppMessage）
- 模板消息（Template）
- 延迟（Delay）

### 双输出节点（分支）
- **AI 处理**：
  - `true` (Handoff)：AI置信度低于阈值，转人工
  - `false` (继续)：AI置信度足够，继续自动化流程
  
- **条件判断**：
  - `true`：条件满足
  - `false`：条件不满足
  
- **合规检查**：
  - `pass`：检查通过
  - `fail`：检查失败
  
- **自定义API**：
  - `success`：API调用成功
  - `error`：API调用失败

## 最佳实践

### 典型工作流结构
```
消息触发器 → AI处理 → [高置信度] → 合规检查 → 延迟 → 发送消息 → 更新数据
                   ↓
              [低置信度] → 人工接手
```

### 建议
1. 每个工作流只设置一个触发器
2. 使用条件判断实现复杂业务逻辑
3. 在发送消息前添加合规检查
4. 使用延迟节点避免过于频繁的消息
5. 及时更新数据库以记录客户互动

## 更新日志
- 2024-10: 重新组织节点分类，提升用户体验
- 新增分类标签快速筛选功能
- 统一触发器和节点选择器的UI风格

