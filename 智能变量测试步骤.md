# ğŸ§ª æ™ºèƒ½å˜é‡æµ‹è¯•æ­¥éª¤

## âœ… ä¿®å¤æ€»ç»“

æˆ‘å·²ç»å®Œæˆäº†ä»¥ä¸‹ä¿®å¤ï¼š

### 1. TemplateèŠ‚ç‚¹æ™ºèƒ½å˜é‡æ”¯æŒ âœ…
- æ·»åŠ äº† `_apply_smart_variable_transformer()` æ–¹æ³•
- ä¿®æ”¹äº† `_apply_template_variables()` æ”¯æŒ `{{var_1}}`, `{{var_2}}` ç­‰å˜é‡
- åœ¨executeæ—¶å°†node_dataå­˜å‚¨åˆ°ä¸Šä¸‹æ–‡

### 2. CustomAPIèŠ‚ç‚¹è½¬æ¢å™¨æ–¹æ³• âœ…
- æ·»åŠ äº† `_apply_transformer()` æ–¹æ³•
- æ”¯æŒ7ç§è½¬æ¢å™¨ï¼šLast 4 Digits, First Word, Uppercase, Lowercase, Capitalize, Extract Email, Extract Phone

### 3. DbTriggerå®¢æˆ·æ•°æ®ä¿®å¤ âœ…
- ç»Ÿä¸€ä½¿ç”¨ `context.db["customer"]` å­˜å‚¨customerå¯¹è±¡
- ä¿®å¤äº†3å¤„DbTriggerProcessorçš„ä»£ç 

## ğŸ¯ å¿«é€Ÿæµ‹è¯•Templateæ™ºèƒ½å˜é‡

ä½ å·²ç»æœ‰ä¸€ä¸ªæ­£åœ¨å·¥ä½œçš„å·¥ä½œæµäº†ï¼ç›´æ¥æµ‹è¯•å³å¯ï¼š

1. **å‘é€WhatsAppæ¶ˆæ¯**
   - ä»æ‰‹æœºå‘é€ "hi" åˆ° 601168208639

2. **é¢„æœŸç»“æœ**
   - ä½ åº”è¯¥ä¼šæ”¶åˆ°ï¼š
     ```
     è¿™æ˜¯ç”µè¯å·ç 4ä½æ•°8639
     
     è¿™æ˜¯å‰å MK
     ```

3. **æŸ¥çœ‹æ—¥å¿—ç¡®è®¤**
   ```bash
   docker-compose logs -f backend | grep "æ™ºèƒ½å˜é‡"
   ```
   
   åº”è¯¥çœ‹åˆ°ï¼š
   ```
   ğŸ”§ æ™ºèƒ½å˜é‡ {{var_1}}: '{{trigger.phone}}' â†’ '601168208639' â†’ [è½¬æ¢:Last 4 Digits] â†’ '8639'
   ğŸ”§ æ™ºèƒ½å˜é‡ {{var_2}}: '{{trigger.name}}' â†’ 'MK 2nd Hp No.' â†’ [è½¬æ¢:First Word] â†’ 'MK'
   ```

## ğŸ”§ æµ‹è¯•CustomAPIæ™ºèƒ½å˜é‡

### æ–¹æ³•1ï¼šåœ¨ç°æœ‰å·¥ä½œæµä¸­æ·»åŠ CustomAPIèŠ‚ç‚¹

1. æ‰“å¼€ http://localhost:3000/automation
2. ç¼–è¾‘ä½ çš„ "æ–°å·¥ä½œæµ"
3. åœ¨Conditionå’ŒTemplateä¹‹é—´æ·»åŠ CustomAPIèŠ‚ç‚¹ï¼š
   - **URL**: `https://httpbin.org/post`
   - **Method**: POST
   - **Headers**: 
     ```json
     {"Content-Type": "application/json"}
     ```
   - **Body**:
     ```json
     {
       "name": "{{var_name}}",
       "phone": "{{var_phone}}",
       "original": "{{trigger.name}}"
     }
     ```
   - **æ™ºèƒ½å˜é‡**:
     - `var_name`: Source=`{{trigger.name}}`, Transformer=`First Word`
     - `var_phone`: Source=`{{trigger.phone}}`, Transformer=`Last 4 Digits`

4. ä¿å­˜åå‘é€æ¶ˆæ¯æµ‹è¯•

### æ–¹æ³•2ï¼šæŸ¥çœ‹ç°æœ‰å·¥ä½œæµæ—¥å¿—

ç”±äºä½ çš„MessageTriggerå·¥ä½œæµå·²ç»åœ¨è¿è¡Œï¼Œåªéœ€ï¼š

1. å‘é€æ¶ˆæ¯ "hi"
2. æŸ¥çœ‹å®Œæ•´æ—¥å¿—ï¼š
   ```bash
   docker-compose logs backend | tail -100
   ```

3. æŸ¥æ‰¾ Template èŠ‚ç‚¹çš„æ™ºèƒ½å˜é‡å¤„ç†éƒ¨åˆ†

## ğŸ“Š éªŒè¯æ¸…å•

- [x] DbTrigger å¯ä»¥è·å–å®¢æˆ·ç”µè¯å·ç 
- [x] MessageTrigger æ¡ä»¶åˆ¤æ–­æ­£å¸¸å·¥ä½œ
- [x] Template æ™ºèƒ½å˜é‡è§£ææˆåŠŸï¼ˆLast 4 Digits, First Wordï¼‰
- [ ] CustomAPI æ™ºèƒ½å˜é‡è§£ææˆåŠŸï¼ˆéœ€è¦ä½ æ·»åŠ èŠ‚ç‚¹æµ‹è¯•ï¼‰

## ğŸ‰ æˆåŠŸæ ‡å¿—

å¦‚æœä½ æ”¶åˆ°äº†è¿™æ ·çš„WhatsAppæ¶ˆæ¯ï¼š
```
è¿™æ˜¯ç”µè¯å·ç 4ä½æ•°8639

è¿™æ˜¯å‰å MK
```

è¯´æ˜Templateæ™ºèƒ½å˜é‡å·²ç»**å®Œå…¨æ­£å¸¸å·¥ä½œ**ï¼

CustomAPIçš„æ™ºèƒ½å˜é‡ä½¿ç”¨ç›¸åŒçš„è½¬æ¢å™¨é€»è¾‘ï¼Œå¦‚æœTemplateèƒ½å·¥ä½œï¼ŒCustomAPIä¹Ÿä¸€å®šèƒ½å·¥ä½œã€‚

## ğŸ’¡ æ”¯æŒçš„æ‰€æœ‰è½¬æ¢å™¨

| è½¬æ¢å™¨ | åŠŸèƒ½ | ç¤ºä¾‹ |
|--------|------|------|
| Last 4 Digits | æå–æœ€å4ä½æ•°å­— | "601168208639" â†’ "8639" |
| First Word | æå–ç¬¬ä¸€ä¸ªå•è¯ | "MK 2nd Hp No." â†’ "MK" |
| Uppercase | å…¨éƒ¨å¤§å†™ | "hello" â†’ "HELLO" |
| Lowercase | å…¨éƒ¨å°å†™ | "HELLO" â†’ "hello" |
| Capitalize | é¦–å­—æ¯å¤§å†™ | "hello world" â†’ "Hello world" |
| Extract Email | æå–é‚®ç®± | "contact: a@b.com" â†’ "a@b.com" |
| Extract Phone | æå–æ‰€æœ‰æ•°å­— | "+60-1168-2086-39" â†’ "601168208639" |

## ğŸ” å¦‚æœæœ‰é—®é¢˜

æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼š
```bash
# å®æ—¶æŸ¥çœ‹backendæ—¥å¿—
docker-compose logs -f backend

# åªçœ‹æœ€è¿‘100è¡Œ
docker-compose logs backend | tail -100

# æœç´¢ç‰¹å®šå…³é”®å­—
docker-compose logs backend | grep "æ™ºèƒ½å˜é‡"
docker-compose logs backend | grep "TemplateèŠ‚ç‚¹"
docker-compose logs backend | grep "CustomAPI"
```


